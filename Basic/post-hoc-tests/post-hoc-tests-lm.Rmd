---
output:
  html_document:
    css: custom-blockquote.css
--- 

```{r setup&variables, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# title: Post Hoc Tests - multiple comparisons in linear models with glht()
# author: jonathan
# revised: 11/4/2020 

WEB <- c("https://bioceed.uib.no/dropfolder/bioSTATS/Rmd/Basic/post-hoc-tests/post-hoc-tests-lm.html")
GIT <- c("https://github.com/jonathansoule/biostats/blob/master/Basic/post-hoc-tests/post-hoc-tests-lm.Rmd")
library(multcomp)
library(ggplot2)
```

You have been running a [one-way ANOVA](https://biostats.w.uib.no/one-way-anova/){target="_blank"} with `lm()` and `anova()`, and the F-test has revealed the existence of a significant difference between some of the tested groups. But which groups? To answer that question, you will need to run the appropriate *post-hoc* tests to assess the significance of differences between pairs of group means. The function `glht()` in the package `multcomp` will help you do this.

We will reuse the example introduced [here (one-way ANOVA)](https://biostats.w.uib.no/one-way-anova/){target="_blank"}.
To create the corresponding dataframe, use the following code:
```{r dataframe}
# response variable
size <- c(25,22,28,24,26,24,22,21,23,25,26,30,25,24,21,27,28,23,25,24,20,22,24,23,22,24,20,19,21,22)

# predictor variable
location <- as.factor(c(rep("ForestA",10), rep("ForestB",10), rep("ForestC",10)))

# dataframe
my.dataframe <- data.frame(size,location)
```
<br/><br/>

For recall, here is the corresponding plot:
```{r boxplot, echo=FALSE}
ggplot(my.dataframe, aes(x = location, y = size)) +
  geom_boxplot()
```
<br/><br/>

### Running the test with `glht()`

First we need to activate the package `multcomp`:
```{r package, eval=FALSE}
library(multcomp)
```
<br/>

Running the test with `glht()` involves using two other functions:

+ `lm()` which fits a linear model to your data, and which syntax is `lm(response ~ predictor, data = dataframe)`,
+ `summary()` which computes and displays the result table, and which we will use after `glht()`.

<br/>
First, we need to fit the linear model with `lm()`, which you have certainly already done. Then we run the model in `glht()`. The syntax for `glht()` is `glht(modelt, linfct = mcp(predictor = 'Tukey'))` where `predictor` is the predictor variable which levels have to be compared pairwise. Finally, we run the result in `summary()`.
Let's apply this to our example:
```{r glht}
# fit the model
model <- lm(size ~ location, data = my.dataframe)

# run glht()
post.hoc <- glht(model, linfct = mcp(location = 'Tukey'))

# get the result table
summary(post.hoc)
```
The output shows all three pairwise comparisons, p-values and corresponding stars. And only the last comparison shows a p-value under 0.05.

<br/><br/>

***
<!-- UNCOMMENT TO ACTIVATE
Get the Rmarkdown file corresponding to this page on [GitHub](`r GIT`){target="_blank"}.
-->
