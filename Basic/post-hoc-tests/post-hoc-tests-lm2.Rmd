---
output:
  html_document:
    css: custom-blockquote.css
--- 

```{r setup&variables, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# title: Post Hoc Tests - multiple comparisons in linear models with glht() - 2
# author: jonathan
# revised: 12/4/2020 

WEB <- c("https://bioceed.uib.no/dropfolder/bioSTATS/Rmd/Basic/post-hoc-tests/post-hoc-tests-lm2.html")
GIT <- c("https://github.com/jonathansoule/biostats/blob/master/Basic/post-hoc-tests/post-hoc-tests-lm2.Rmd")
library(multcomp)
library(ggplot2)
```

You have been running a [two-way ANOVA](https://biostats.w.uib.no/factorial-design/){target="_blank"} with `lm()` and `anova()`, and the F-test has revealed the existence of a significant difference between some of the tested groups. But which groups? To answer that question, you will need to run the appropriate *post-hoc* tests to assess the significance of differences between pairs of group means. The function `glht()` in the package `multcomp` will help you do this.

We will reuse the example introduced [here (factorial design (two-way ANOVA))](https://biostats.w.uib.no/factorial-design/){target="_blank"}.
To create the corresponding dataframe, use the following code:
```{r dataframe}
# response variable
size <- c(25,22,28,24,26,24,22,21,23,25,26,30,25,24,21,27,28,23,25,24,20,22,24,23,22,24,20,19,21,22,24,27,26,24,25,27,22,28,25,24,27,29,26,27,25,27,28,24,24,26,21,23,25,20,25,23,25,19,22,21)

# predictor variables
location <- as.factor(c(rep("ForestA",10), rep("ForestB",10), rep("ForestC",10), rep("ForestA",10), rep("ForestB",10), rep("ForestC",10)))
year <- as.factor(c(rep("2005",30), rep("2015",30)))

# dataframe
my.dataframe <- data.frame(size,location,year)
```
<br/><br/>

For recall, here is the corresponding plot:
```{r boxplot, echo=FALSE}
ggplot(my.dataframe, aes(x = location, y = size, fill = year)) +
  geom_boxplot()
```
<br/><br/>

### Running the test with `glht()`

First we need to activate the package `multcomp`:
```{r package, eval=FALSE}
library(multcomp)
```
<br/>

Running the test with `glht()` involves using two other functions:

+ `lm()` which fits a linear model to your data, and which syntax is `lm(response ~ predictor1 * predictor2, data = dataframe)`; however, if the interaction term is not to be included in the model, the syntax becomes `lm(response ~ predictor1 + predictor2, data = dataframe)`,
+ `summary()` which computes and displays the result table, and which we will use after `glht()`.

<br/>
First, we need to fit the linear model with `lm()`. Then we run the model in `glht()`. The syntax for `glht()` is `glht(model, linfct = mcp(predictor = 'Tukey'))` where `predictor` is the predictor variable which levels have to be compared pairwise (in our example, there was a main effect of 'location' only). Then, we run the result in `summary()`.
Let's apply this to our example in which there was a main effect of (and only of) `location`, and in which the interaction term was removed from the model:
```{r glht}
# fit the model
model <- lm(size ~ location + year, data = my.dataframe)

# run glht()
post.hoc <- glht(model, linfct = mcp(location = 'Tukey'))

# get the result table
summary(post.hoc)
```

The table now shows two pairs of means with significant differences.
<br/><br/>

***
<!-- UNCOMMENT TO ACTIVATE
Get the Rmarkdown file corresponding to this page on [GitHub](`r GIT`){target="_blank"}.
-->

